<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Google OAuth redirect override for local dev (must match client config) -->
    <meta name="polly-google-redirect-uri" content="http://localhost:5500/">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polly Gallery</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/login.css">
    <!-- Model Viewer: CSP-friendly 3D viewer (no unsafe-eval) -->
    <script type="module" src="https://unpkg.com/@google/model-viewer@1.12.0/dist/model-viewer.min.js"></script>
    <style>
      /* Basic gallery-specific overrides if needed */
      /* é¡¶éƒ¨å¯¼èˆªä¸å†…å®¹çš„æ‹¥æŒ¤æ„Ÿä¼˜åŒ–ï¼ˆä»… Gallery é¡µä½œç”¨ï¼‰ */
      /* å–æ¶ˆé¡µé¢å†…è”çš„å¯¼èˆªå†…è¾¹è·è¦†ç›–ï¼Œç»Ÿä¸€ä½¿ç”¨å…¨å±€æ ·å¼ */
      /* header nav { padding: clamp(10px, 2.4vw, 16px) 24px; } */
      /* ç»Ÿä¸€ä½¿ç”¨å…¨å±€æ ·å¼ä¸­çš„å›ºå®šé—´è·ï¼ˆé¿å…é¡µé¢åˆ‡æ¢é€ æˆå·®å¼‚ï¼‰ */
      /* .nav-links { gap: 40px; } // ä¸å†åœ¨é¡µé¢å†…è¦†ç›– */

      /* Gallery æ ‡é¢˜ä¸æ­£æ–‡é—´è·ä¸è‡ªé€‚åº”å­—å· */
      .converter-section {
        padding-top: clamp(18px, 3.2vw, 36px);
      }
      .converter-section .container h2 {
        margin-bottom: 12px;
        font-size: clamp(22px, 2.8vw, 28px);
        line-height: 1.2;
      }
      .converter-section .container p {
        font-size: clamp(14px, 2.2vw, 16px);
        line-height: 1.7;
        margin-bottom: clamp(12px, 2.6vw, 16px) !important;
        color: #6c757d;
      }

      /* è¿‡æ»¤åŒºä¸ç½‘æ ¼å‰çš„é—´è·ä¼˜åŒ– */
      #gallery-filters {
        margin-bottom: clamp(12px, 2.6vw, 18px) !important;
      }

      @media (max-width: 480px) {
        #gallery-filters {
          margin-bottom: 12px !important;
        }
      }

      /* é¡µåº•èƒŒæ™¯æ”¹ä¸ºä½“éªŒå›¾ï¼ˆä»… Gallery é¡µï¼Œæ›´é«˜ä¼˜å…ˆçº§è¦†ç›–ï¼‰ */
      .converter-section + footer::before {
        background: url('assets/images/tab2-bg.png') center / cover no-repeat !important;
        backdrop-filter: none !important;
        opacity: 1 !important;
        content: "" !important;
        position: absolute !important;
        inset: 0 !important;
        pointer-events: none !important;
      }

      /* ç›´æ¥è¦†ç›–æ•´é¡µèƒŒæ™¯ï¼šä¸¥æ ¼ä½¿ç”¨æä¾›çš„å›¾ç‰‡ */
      body {
        background-color: #F4F7FF !important;
        background-image: url('assets/images/tab2-bg.png') !important;
        background-repeat: no-repeat !important;
        background-position: center top !important;
        background-size: cover !important;
      }
    </style>
</head>
<body>
    <header>
        <nav>
        <a class="logo" href="index.html" aria-label="Polly home">
          <img src="assets/images/logo-modern.svg" alt="Polly logo" onerror="this.onerror=null; this.src='assets/images/logo.png';" />
          <span class="logo-text">Polly</span>
        </a>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="gallery.html" class="active">Gallery</a></li>
        <li><a href="faq.html">FAQ</a></li>
        <li><a id="login-link" href="#">Login</a></li>
        <!-- User menu: shown after authentication -->
        <li id="user-menu" style="display:none; position:relative;">
          <button id="avatar-button" class="avatar-btn" aria-label="User menu">
            <img id="avatar-image" alt="User avatar" />
          </button>
          <div id="user-popover" class="user-popover" style="display:none;">
            <a id="menu-assets" class="popover-item" href="assets.html">
              <span class="popover-icon" aria-hidden="true">ğŸ‘¤</span>
              <span class="popover-text">My Assets</span>
            </a>
            <a id="menu-order" class="popover-item" href="order.html">
              <span class="popover-icon" aria-hidden="true">ğŸ§¾</span>
              <span class="popover-text">My order</span>
            </a>
            <button id="menu-signout" class="popover-item" type="button">
              <span class="popover-icon" aria-hidden="true">â†©ï¸</span>
              <span class="popover-text">Sign out</span>
            </button>
          </div>
        </li>
      </ul>
        </nav>
    </header>

    <section class="converter-section">
        <div class="container">
            <h2>Inspiration Gallery</h2>
            <p style="margin-bottom: 16px; color:#6c757d;">Discover Stunning AI-Generated 3D Models & Spark Your Creativity</p>

            <!-- Categories -->
            <div id="gallery-filters" style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:16px;">
              <span class="btn btn-text filter-chip active" data-filter="all">All</span>
              <span class="btn btn-text filter-chip" data-filter="object">Object</span>
              <span class="btn btn-text filter-chip" data-filter="car">Car</span>
              <span class="btn btn-text filter-chip" data-filter="helmet">Helmet</span>
              <span class="btn btn-text filter-chip" data-filter="role">Role</span>
            </div>

            <!-- Toolbar removed: no sorting -->

            <div id="gallery-grid" class="gallery-grid"></div>
            <div id="gallery-loader" class="gallery-loader" aria-live="polite" aria-busy="false">Loading moreâ€¦</div>
            <!-- Infinite scroll sentinel -->
            <div id="gallery-sentinel" style="height: 1px; margin-top: 8px; opacity: 0; pointer-events: none;"></div>
        </div>
    </section>

    <!-- 3D Preview Modal -->
    <div id="model-modal" class="modal" style="display:none;">
        <div class="modal-content">
            <span id="modal-close" class="modal-close">&times;</span>
            <div id="modal-3d-container" style="width:100%; height:70vh; background:rgba(0,0,0,0.05); border-radius:8px;"></div>
            <div style="margin-top: 12px; display:flex; justify-content:flex-end; gap:8px;">
                <button id="modal-prev" class="btn btn-text">Prev</button>
                <button id="modal-next" class="btn btn-text">Next</button>
                <button id="modal-download-glb" class="btn btn-download-glb" disabled>Download GLB</button>
                <button id="modal-download-snapshot" class="btn btn-secondary" disabled>Download Poster</button>
            </div>
        </div>
    </div>

<footer>
  <div class="container">
    <div class="footer-frame">
      <p class="footer-copyright">&copy; 2023 Polly. All rights reserved.</p>
      <div class="footer-links contact-row">
        <a class="footer-email" href="mailto:support@polly3d.com" aria-label="Email support@polly3d.com">support@polly3d.com</a>
        <a class="footer-phone" href="tel:8888888888" aria-label="Phone 888-888-8888">888-888-8888</a>
      </div>
      <div class="footer-list">
        <a class="footer-privacy" href="privacy.html">Privacy Policy</a>
        <a class="footer-terms" href="terms.html">Terms of Use</a>
      </div>
    </div>
  </div>
</footer>

  <!-- Login Modal (Figma-styled) -->
  <div id="login-modal" class="login-overlay">
    <div class="login-card">
      <div class="login-header">
        <span class="login-title">Sign In</span>
        <button id="login-close" aria-label="Close" class="login-close">Ã—</button>
      </div>
        <!-- Step 1: method selection -->
      <div id="login-step-select" class="login-section" style="display:block;">
        <button id="select-email-or-phone" class="login-btn neutral figma-cta">
          <span>âœ‰ï¸</span>
          <span class="gradient-label">Continue with Email/Phone</span>
        </button>
            <button id="select-apple" class="login-btn neutral figma-cta">
              <span class="gradient-icon">ï£¿</span>
              <span class="gradient-label">Continue with AppleID</span>
            </button>
        <button id="select-google" class="login-btn neutral figma-cta">
          <span class="gradient-icon">G</span>
          <span class="gradient-label">Continue with Google</span>
        </button>
        <div class="login-disclaimer">I agree to the <a href="terms.html">Terms of Use</a> and <a href="privacy.html">Privacy Policy</a></div>
      </div>
        <!-- Step 2: forms -->
      <div id="login-step-forms" class="login-section" style="display:none;">
        <div class="login-row" style="margin-bottom:10px;">
          <button id="login-back" class="login-back">â†</button>
          <div style="flex:1"></div>
        </div>
        <div class="login-tabs">
          <button id="tab-sms-otp" class="login-btn neutral tab">Phone</button>
          <button id="tab-email-otp" class="login-btn neutral tab">Email</button>
        </div>
          <!-- SMS OTP Login -->
        <div id="login-form-sms-otp" class="login-form" style="display:flex;">
          <div class="login-row">
            <select id="sms-country" class="login-select">
              <option value="+886">TW +886</option>
              <option value="+86">CN +86</option>
              <option value="+852">HK +852</option>
              <option value="+81">JP +81</option>
              <option value="+1">US +1</option>
            </select>
            <input id="sms-otp-phone" type="tel" placeholder="Phone number" class="login-input" />
          </div>
          <div class="login-row">
            <input id="sms-otp-code" type="text" placeholder="Verification code" class="login-input" />
            <button id="sms-otp-send" class="login-btn neutral" style="flex:0 0 140px;">Send</button>
          </div>
          <button id="sms-otp-login" class="login-btn primary login-submit" disabled>Continue</button>
        </div>
          <!-- Email OTP Login -->
        <div id="login-form-email-otp" class="login-form">
          <input id="email-otp-email" type="email" placeholder="Email" class="login-input" />
          <div class="login-row">
            <input id="email-otp-code" type="text" placeholder="Verification code" class="login-input" />
            <button id="email-otp-send" class="login-btn neutral" style="flex:0 0 140px;">Send</button>
          </div>
          <button id="email-otp-login" class="login-btn primary login-submit" disabled>Continue</button>
        </div>
        <div class="login-disclaimer">I agree to the <a href="terms.html">Terms of Use</a> and <a href="privacy.html">Privacy Policy</a></div>
      </div>
      <div id="login-error" class="login-error" style="display:none;">Sign in failed, please try again.</div>
    </div>
  </div>

  <!-- Apple Sign-In Web SDK -->
  <script src="https://appleid.cdn-apple.com/appleauth/static/jsapi/appleid/1/en_US/appleid.auth.js"></script>
  <script>
    (function(){
      try {
        // åœ¨ localhost ç¯å¢ƒä¸‹ï¼Œä½¿ç”¨æœ¬åœ°ä»£ç†ï¼Œé¿å…è·¨åŸŸå¤±è´¥
        if (window.location.hostname === 'localhost') {
          window.POLLY_AUTH_BASE = 'http://localhost:8788/';
          window.POLLY_API_BASE = 'http://localhost:8788/';
          window.POLLY_API_FALLBACK_BASE = '';
          window.POLLY_PREFER_FORMDATA_FIRST = false;
        }
      } catch(_){ }
    })();
  </script>
  <script>
    (function(){
      try {
        if (window.location.hostname === 'localhost') {
          window.POLLY_GOOGLE_CLIENT_ID = '461513375444-op1d4mv4qtj3ccphlhln9prfgpa5ias3.apps.googleusercontent.com';
          window.POLLY_GOOGLE_FORCE_DIRECT = true;
          window.POLLY_GOOGLE_RESPONSE_TYPE = 'token id_token';
          window.POLLY_GOOGLE_SCOPE = 'openid email profile';
        }
      } catch(_){ }
    })();
  </script>
  <script>
    (function(){
      const loginLink = document.getElementById('login-link');
      const loginModal = document.getElementById('login-modal');
      const loginClose = document.getElementById('login-close');
        // ç‚¹å‡»èƒŒæ™¯å…³é—­
        if (loginModal) {
          loginModal.addEventListener('click', function(e){ if (e.target === loginModal) { loginModal.style.display = 'none'; } });
        }
        const loginStepSelect = document.getElementById('login-step-select');
        const loginStepForms = document.getElementById('login-step-forms');
        const loginBack = document.getElementById('login-back');
      const tabEmailOtp = document.getElementById('tab-email-otp');
      const tabSmsOtp = document.getElementById('tab-sms-otp');
      const formEmailOtp = document.getElementById('login-form-email-otp');
      const formSmsOtp = document.getElementById('login-form-sms-otp');
      const selectApple = document.getElementById('select-apple');
      function showSelect(){ if(loginStepSelect && loginStepForms){ loginStepSelect.style.display='block'; loginStepForms.style.display='none'; } }
      function showForms(){ if(loginStepSelect && loginStepForms){ loginStepSelect.style.display='none'; loginStepForms.style.display='block'; } }
      function showTab(name){ if(formEmailOtp && formSmsOtp){ formEmailOtp.style.display = (name==='email-otp') ? 'flex' : 'none'; formSmsOtp.style.display = (name==='sms-otp') ? 'flex' : 'none'; } }
      function openModal(){ if(loginModal){ loginModal.style.display='flex'; showSelect(); } }
      function closeModal(){ if(loginModal){ loginModal.style.display='none'; } }
      loginLink && loginLink.addEventListener('click', function(e){ e.preventDefault(); openModal(); });
      loginClose && loginClose.addEventListener('click', closeModal);
      loginBack && loginBack.addEventListener('click', showSelect);
      tabEmailOtp && tabEmailOtp.addEventListener('click', function(){ showTab('email-otp'); });
      tabSmsOtp && tabSmsOtp.addEventListener('click', function(){ showTab('sms-otp'); });
      const selectEmailOrPhone = document.getElementById('select-email-or-phone');
      selectEmailOrPhone && selectEmailOrPhone.addEventListener('click', function(){ showForms(); showTab('sms-otp'); });
      // Apple ç™»å½•ï¼šä¼˜å…ˆè°ƒç”¨å®˜æ–¹ SDKï¼Œå¤±è´¥æ—¶å›é€€åˆ°åç«¯é‡å®šå‘
      function loginWithApple(){
        const base = (function(){
        try {
          var b = window.POLLY_AUTH_BASE || '';
          if (b) {
            if (!/\/$/.test(b)) b += '/';
            return b + 'oauth/apple/start';
          }
        } catch(_){ }
        return (window.POLLY_API && typeof window.POLLY_API.url === 'function') ? window.POLLY_API.url('oauth/apple/start') : '/oauth/apple/start';
      })();
        const redirectUri = window.location.origin + '/';
        const url = base + (base.includes('?') ? '&' : '?') + 'redirect_uri=' + encodeURIComponent(redirectUri);
        try {
          if (window.AppleID && AppleID.auth && typeof AppleID.auth.signIn === 'function' && window.POLLY_APPLE_CLIENT_ID && window.POLLY_APPLE_REDIRECT_URI) {
            AppleID.auth.init({
              clientId: window.POLLY_APPLE_CLIENT_ID,
              scope: window.POLLY_APPLE_SCOPE || 'name email',
              redirectURI: window.POLLY_APPLE_REDIRECT_URI,
              state: window.POLLY_APPLE_STATE || '',
              nonce: window.POLLY_APPLE_NONCE || '',
              usePopup: true
            });
            AppleID.auth.signIn().catch(function(){ window.location.href = url; });
          } else {
            window.location.href = url;
          }
        } catch (_) {
          window.location.href = url;
        }
      }
      selectApple && selectApple.addEventListener('click', loginWithApple);
      // æ”¯æŒ URL å‚æ•°è§¦å‘å¼¹çª—ï¼š?login=1
      try {
        const sp = new URLSearchParams(window.location.search);
        if (sp.get('login') === '1') { openModal(); }
      } catch(_) {}
    })();
  </script>

    <!-- Config + shared auth/UI logic -->
    <script src="js/config.js" defer></script>
    <script src="js/main.js" defer></script>
    <script src="js/gallery.js" defer></script>
    <script src="js/fallback.js" defer></script>
  </body>
</html>